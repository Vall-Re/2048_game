var t,e={};const s=new((t=class{#t;#e;#s;#i;constructor(t){this.#i=t||this.#r(),this.#t=JSON.parse(JSON.stringify(this.#i)),this.#e=0,this.#s="idle",console.log(t)}moveLeft(){this.#a("left")}moveRight(){this.#a("right")}moveUp(){this.#a("up")}moveDown(){this.#a("down")}getScore(){return this.#e}getState(){return JSON.parse(JSON.stringify(this.#t))}getStatus(){return this.#s}start(){("idle"===this.#s||"lose"===this.#s)&&(this.#t=JSON.parse(JSON.stringify(this.#i)),this.#o(),this.#o(),this.#e=0,this.#s="playing")}restart(){this.#t=JSON.parse(JSON.stringify(this.#i)),this.#e=0,this.#s="playing",this.#o(),this.#o()}#r(){return Array.from({length:4},()=>[,,,,].fill(0))}#o(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.#t[e][s]&&t.push([e,s]);if(0===t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)],i=.9>Math.random()?2:4;this.#t[e][s]=i}#n(t){let e=[...t],s=t.filter(t=>0!==t),i=[],r=0;for(let t=0;t<s.length;t++)if(s[t]===s[t+1]){let e=2*s[t];i.push(e),r+=e,t++}else i.push(s[t]);for(;i.length<4;)i.push(0);let a=JSON.stringify(e)!==JSON.stringify(i);return{newRow:i,scoreGained:r,changed:a}}#a(t){if("playing"!==this.#s)return;let e=t=>t.map(t=>[...t].reverse()),s=t=>t[0].map((e,s)=>t.map(t=>t[s])),i=JSON.parse(JSON.stringify(this.#t)),r=!1,a=0;"right"===t?i=e(i):"up"===t?i=s(i):"down"===t&&(i=e(i=s(i)));let o=i.map(t=>{let{newRow:e,scoreGained:s,changed:i}=this.#n(t);return i&&(r=!0),a+=s,e});"right"===t?o=e(o):"up"===t?o=s(o):"down"===t&&(o=s(o=e(o)));let n=JSON.stringify(this.#t);this.#t=o,this.#e+=a,r&&n!==JSON.stringify(this.#t)&&(this.#d(),"win"!==this.#s&&this.#o(),this.#l())}#d(){for(let t of this.#t)if(t.includes(2048)){this.#s="win";return}}#l(){if(!this.#t.flat().includes(0)){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.#t[t][e];if(t<3&&this.#t[t+1][e]===s||e<3&&this.#t[t][e+1]===s)return}this.#s="lose"}}}).__esModule?t.default:t),i=document.querySelector(".button"),r=document.querySelector(".game-score"),a=document.querySelectorAll(".field-cell"),o=document.querySelector(".message-start"),n=document.querySelector(".message-win"),d=document.querySelector(".message-lose");function l(){let t=s.getState().flat();a.forEach((e,s)=>{let i=t[s];e.textContent=i||"",e.className="field-cell",i&&e.classList.add(`field-cell--${i}`)}),r.textContent=s.getScore(),o.classList.add("hidden"),n.classList.add("hidden"),d.classList.add("hidden");let e=s.getStatus();"idle"===e?o.classList.remove("hidden"):"win"===e?n.classList.remove("hidden"):"lose"===e&&d.classList.remove("hidden")}i.addEventListener("click",()=>{"idle"===s.getStatus()?(s.start(),i.textContent="Restart",i.classList.remove("start"),i.classList.add("restart")):s.restart(),l()}),document.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;default:return}l()}),l();
//# sourceMappingURL=index.dac91743.js.map
